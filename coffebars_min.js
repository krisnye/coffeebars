(function(){var e,t,n;t=function(){return this}(),n=/\{\{\{?([\w\W]*?)\}\}\}?/g,exports.compile=function(e){return require("coffee-script").eval(exports.parse(e))},exports.parse=function(e){var t,r,i,s,o,u,a,f,l,c,h,p;t=[],u=1,o=function(){var e,t,n;t="";for(e=n=0;0<=u?n<u:n>u;e=0<=u?++n:--n)t+="	";return t},c=function(e,n){return n==null&&(n=0),t.push(o()),t.push(e,"\n"),u+=n},a=0,p=function(t){var r,i;return r=e.substring(a,(i=t!=null?t.index:void 0)!=null?i:e.length),a=n.lastIndex,c("write "+JSON.stringify(r))},s=function(e,t){var n,r,i,s,u,a,f,l,c;a=Number.MAX_VALUE,u=e.split(/\r\n|\r|\n/);for(r=f=0,l=u.length;f<l;r=++f){i=u[r];if(!(i.trim().length>0))continue;if(r===0)throw new Error("Multiline script cannot start on same line as opening brace:\n"+t[0]);s=(c=i.match(/^\s*/))!=null?c[0].length:void 0,s!=null&&(a=Math.min(a,s))}return n=o(),u.map(function(e){return n+e.substring(a)}).join("\n")};while(f=n.exec(e))p(f),l=f[1],r=0,/^\s*(else|catch)\b\s*([\w\W]+)/.test(l)?(u--,r=1,l=l.trim()):/^\s*(if|for|while|unless|try)\s*([\w\W]+)/.test(l)?(r=1,l=l.trim()):/^\s*end\s*$/.test(l)?(u--,l=null):/\r|\n/.test(l)?l=s(l,f):(i=f[0].substring(0,3)!=="{{{",l="write ("+l+"), "+i),l!=null&&c(l,r);return p(f),e=t.join(""),h="template = (write) ->\n"+e+"\n	return\n\n(context, write) ->\n	buffer = null\n	if not write\n		buffer = []\n		write = (text) -> buffer.push text if text?\n	template.call context, write\n	buffer?.join ''",h},require.main===module&&(e=process.argv.slice(2),e.length===0?console.log("Usage: coffeebars template"):console.log(exports.parse(require("fs").readFileSync(e[0],"utf8"))))}).call(this)